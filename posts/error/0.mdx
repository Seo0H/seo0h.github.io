---
title: 'Client-side Exception Error'
description: 'dev mode일때는 분명 잘 돌아갔는데..?'
draft: true
date: 2023-09-08 23:31:38
---
## 발단
![문제상황 1](/posts/0/230908-233311.png)
![문제상황 2](/posts/0/230908-233325.png)

분명 dev 모드 일때는 잘 돌아갔지만, push 후 빌드 되는 상황이 영 좋지 못했다. 변경 사항이 꽤 있던 지라.. 걱정을 안고 문제를 해결하기로 결심했다.

## 일단 검색!
일단 이런 상황이 발생하는 이유는, 클라이언트 측 UI와 서버에서 랜더링 된 UI가 다르기 때문이다. 해당 [문제 번호]('https://legacy.reactjs.org/docs/error-decoder.html/?invariant=418')를 검색해보니, 여러가지 경우의 수가 있을 수 있었다.

```
1. 코드를 분할하여 dynamic import
2. 웹사이트 쿠키 삭제 (?)
3. className 일치시키기
```

3개 다 시도를 해봤지만, **효과가 없었다.**

## 문제의 발견

처음에는 이전 빌드가 잘 되었던 상황으로 돌아가보았다. 여러 가능성이 있었지만 주석을 달아가며 확인 해 본 결과 글의 'Tag'를 mdx의 경로에서 가져오기 전에는 잘 돌아갔던 것을 확인했다. (참고로 파일 구조에서 마지막 파일을 Tag로 사용하기 위해 구조를 바꾸기도 했었다.)

그렇게 하나하나 확인해 보니, getTag라는 **유틸 함수가 문제**였다.

``` jsx
 <Layout.VStack>
    <CrosshatchTag>{getTag(post)}</CrosshatchTag>
</Layout.VStack>
```

기존에는 위처럼 컴포넌트 내부에서 해당 유틸 함수를 불러오는 방식이였다.

컴포넌트 안에서 함수를 실행해서 문제가 있는건가 싶어, 외부로 빼서 선언 후 사용도 해 보고, state 선언을 해서 사용 해 보았는데 이 문제가 해결되진 않았다.

### 문제의 해결

`getTag`에서 인자로 받던 `post`가 비동기적으로 넘어오는 것과 관련이 있을까 싶어 해당 유틸 함수를 커스텀 hook으로 분리해 사용해보았다.

그랬더니 웬일인지,, 해결이 됐다. 해결이 되었지만 왜 해결이 됐는지 모르는 이 찝찝한 상황이 불편했다.

의심이 되는 큰 이유는, `post` 값을 서버 사이드에서 불러온다는 거였다. 따라서 나름의 가설을 세워 보았다.
```
유틸 함수는.. 나중에 마저 쓰자
```