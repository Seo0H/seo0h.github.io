---
title: 'Next.js MDX 파싱하기'
description: 'Contentlayer을 이용한 MDX Paring 환경 구축기'
draft: true
image: '/img/2023/blog-making/thumbnail.png'
date: 2023-10-12 19:32:17
---

## MDX?
이 블로그 글은 [MDX](https://mdxjs.com/)로 작성되었어요. [마크다운(.md)](https://www.markdownguide.org/)으로 글을 작성하면, 가독성 있는 글을 빠르게 작성할 수 있기 때문에 많은 사람들이 선호하는 도구에요.

그 중 MDX는 MD + JSX를 합친 단어로, JSX를 마크다운에서 작성할 수 있게 해줘요. 따라서 MDX를 이용해 글을 쓰면, 마크다운 형식으로 글을 작성하며 React 컴포넌트를 포함시킬 수 있어요.

## MDX와 Next.js

현재(23.10.12) [Next js의 공식문서의 MDX 챕터](https://nextjs.org/docs/pages/building-your-application/configuring/mdx)에서는

1. 로컬 데이터를 이용하는 경우 : `@next/mdx`
2. 원격 데이터를 사용하는 경우 :  `next-mdx-remote`, `contentlayer`

이렇게 두가지에 대해 대안을 제안하고 있어요.

여기서 의미하는 **로컬**이란, **`/pages` 또는 `/app` 하위에 생성되는 페이지들이 `.mdx`로 작성되는 것**을 의미하며,
**`/pages`, `/app` 바깥쪽에 mdx파일이 위치하는 경우 원격**이라고 정의해요.

```shell caption="로컬인 상황 파일 구조 예시"
  your-project
  ├── pages
  │   └── my-mdx-page.mdx
  └── package.json
```

제가 원하는 블로그의 완성 조건은 다음과 같았어요.
> 1. 첫 화면에 소개와 함께, 블로그 포스트들이 뜨도록 하는 것
> 2. 각 포스트 클릭 시 동적인 라우팅을 통해 해당 페이지에 맞는 데이터를 가진 데이터 매칭 구현
> 3. 공통적인 레이아웃 공유 (헤더와 푸터, 각 포스트 등..)
> 4. 이후의 다른 프로젝트와 확장 가능성 염두

각 페이지가 마크다운 그 자체가 되는 것이 좋지만 4번, **확장 가능성 때문에 포스트의 관심사를 다른 곳에 분리**하고 싶었고, 따라서 `contentlayer`를 사용하게 되었어요.

### `next-mdx-remote` VS `contentlayer`

왜 `next-mdx-remote` 가 아닌 `contentlayer`를 사용하게 된 이유는 아래와 같아요.

> 1. **데이터 스키마** 명시적 작성 강제
> 2. 위 스키마에 따라 빌드 시 **TypeScript 유형 정의 생성**

이 두가지를 큰 장점으로 뽑은 이유는 **블로그 글을 작성하면 일정한 탬플릿이 필요**하기 때문이에요. 해당 글의 제목, 부제목 이외에도 글에 대한 메타 정보들이 포함될 수 있는 일정한 양식 말이죠. 이런 메타 정보는 아래와 같은 형식으로 작성되요. `---` 사이에 key - value 형식으로 작성한답니다.

``` md {1,5} caption="마크다운에서 에서 메타데이터 표기 방식"
---
title:'my-title'
description:'my-description'
...
---
```

이런 정보들을 마크다운을 작성할때마다 복사 붙여넣기 하며 작성하는건 꽤 번거로운 일 일거예요. 물론 자동완성 기능을 제공하는 code snippets도 사용하겠지만, Contentlayer 에서 정보의 스키마를 정의해두고 검사해준다면, 해당 정보를 잘못 작성하거나 빼먹을 확률이 적어지겠죠?

![친절하게 문제를 알려주는 contentlayer..](/posts/3/231012-204506.png)

> 🔖 **주의사항** <br />
> **Contentlayer는 아직 beta버전이에요**. 이 글 작성 기준(2023-10-12), 지원되는 프레임워크는 Next.js 뿐이며 지원되는 데이터 소스도 MDX 뿐이에요. 현재 실험적으로 노션으로 컨텐츠를 가져올 수 있어요.

## 설치와 환경 세팅

이제 본격적으로 설치 및 초기 환경 세팅을 해볼까요?

``` cmd
npm install contentlayer next-contentlayer date-fns
```

``` tsx
// next.config.js
const { withContentlayer } = require('next-contentlayer')

/** @type {import('next').NextConfig} */
const nextConfig = { reactStrictMode: true, swcMinify: true }

module.exports = withContentlayer(nextConfig)
```